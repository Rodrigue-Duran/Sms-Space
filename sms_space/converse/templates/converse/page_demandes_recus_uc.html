{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>📥 Demandes reçues</title>
    <link rel="stylesheet" href="{% static 'converse/page_demandes_recus_uc.css' %}">
</head>
<body>
    <div class="menu-toggle" onclick="toggleSidebar()">☰</div>
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">🌓</div>

    <nav class="sidebar" id="sidebar">
        <ul>
            <li><a href="{% url 'page_accueil_uc' user.id %}">🏠 Accueil</a></li>
            <li><a href="{% url 'page_mon_profil_uc' user.id %}">👤 Mon profil</a></li>
            <li><a href="{% url 'page_contact_liste_uc' user.id %}">📇 Contacts</a></li>
            <li><a href="{% url 'page_rechercher_uc_uc' user.id %}">🔍 Rechercher</a></li>
            <li><a href="{% url 'page_signaler_probleme_uc' user.id %}">⚠️ Signaler un problème</a></li>
            <li><a href="{% url 'page_demandes_recus_uc' user.id %}">📥 Demandes reçues</a></li>
            <li><a href="{% url 'page_demandes_envoyees_uc' user.id %}">📤 Demandes envoyées</a></li>
            <li><a href="{% url 'page_se_deconnecter_uc' user.id %}">🚪 Se déconnecter</a></li>
        </ul>
    </nav>

    <main class="main-content fade-in" id="mainContent">
        <h1 class="page-title">📥 Demandes reçues</h1>

        {% if confirmation %}
            <div class="confirmation-message">{{ confirmation }}</div>
        {% endif %}

        <div class="request-list">
            {% for demande in demandes %}
                <div class="request-card">
                    <div class="request-info">
                        <h2>{{ demande.expediteur.pseudo }}</h2>
                        <p>{{ demande.expediteur.nom }} {{ demande.expediteur.prenom }}</p>
                        <p class="request-date">📅 {{ demande.date_denvoie|date:"d/m/Y H:i" }}</p>
                    </div>
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="demande_id" value="{{ demande.id }}">
                        <button type="submit" name="action" value="accepter" class="accept-btn">✅ Accepter</button>
                        <button type="submit" name="action" value="refuser" class="refuse-btn">❌ Refuser</button>
                    </form>
                </div>
            {% empty %}
                <p class="no-request">📭 Aucune demande reçue pour le moment.</p>
            {% endfor %}
        </div>
    </main>

   <script>
        // Appliquer le mode au chargement
        document.addEventListener("DOMContentLoaded", function () {
            const mode = localStorage.getItem("theme");
            if (mode === "dark") {
                document.body.classList.add("dark-mode");
            }
        });

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('mainContent').classList.toggle('shifted');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains("dark-mode");
            localStorage.setItem("theme", isDark ? "dark" : "light");
        }
    </script>

</body>
</html>
